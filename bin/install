#!/usr/bin/env bash

echo "Checking the environment."

red() { echo -e "\033[31m $1\033[0m"; }
green() { echo -e "\033[0;32m$1\033[0m"; }
white() { echo -e "\033[0;37m$1\033[0m"; }

command_exists() { return $(eval "$1 &>/dev/null"; echo $?); }

test_dependency() {
  if command_exists "$1"; then
    green "  ✔  $2 is already installed."
  else
    exec >&2
    red "   ✖  You need to install $2.\c"
    white "\n     $3\n"
  fi
}

(
  set -e
  test_dependency "command -v 'lua'" "lua"
  test_dependency "command -v 'jshint'" "jshint" "npm install -g jshint"
  test_dependency "command -v 'scss-lint'" "scss-lint" "gem install scss-lint"
)

if (( $? != 0 )); then
  exit $?
fi

brew update
brew reinstall vim --override-system-vi --with-lua --HEAD

vim --version
