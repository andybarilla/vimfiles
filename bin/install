#!/usr/bin/env bash

if [ "$1" = "-h" ]
then
  echo -e "usage: bin/install [source_path] [prefix_path]
\t source_path:
\t\t default: /opt/vim
\t prefix_path:
\t\t default: /usr/local"

  exit 0
fi

old_path=$PWD
src_path=${1:-/opt/vim}
vim_prefix=${2:-/usr/local}

if [[ -e $src_path ]]
then
  cd $src_path
  hg pull
  hg update
else
  sudo mkdir -p -m 755 $src_path
  cd $src_path
  hg clone https://vim.googlecode.com/hg/ .
fi

cd src

make clean
make distclean
./configure \
  --enable-gui=no \
  --without-x \
  --enable-multibyte \
  --with-tlib=ncurses \
  --enable-cscope \
  --with-features=huge \
  --enable-pythoninterp \
  --enable-rubyinterp \
  --prefix=$vim_prefix
make
sudo make install prefix=$vim_prefix

cd $old_path
vim --version
